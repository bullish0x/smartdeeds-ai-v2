# Apache configuration for Next.js static export with API proxy support
# FOR ROOT DOMAIN DEPLOYMENT (no base path)
# This ensures all routes are handled correctly while allowing proxy paths

# Disable directory listings and set index.html as directory index
Options -Indexes
DirectoryIndex index.html

<IfModule mod_rewrite.c>
  RewriteEngine On
  
  # CRITICAL: Exclude proxy paths from rewriting
  # This allows Apache ProxyPass directives to handle these requests
  # Add any other proxy paths your VirtualHost defines here
  RewriteRule ^telonium(/.*)?$ - [L,PT]
  
  # PRIORITY 1: If accessing a path and a corresponding .html file exists, serve it
  # This handles cases where both a directory and .html file exist (e.g., /intl/terms/ and /intl/terms.html)
  # Check without trailing slash first
  RewriteCond %{REQUEST_URI} !/$
  RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI}.html -f
  RewriteRule ^(.+)$ $1.html [L]
  
  # Check with trailing slash (but not for root /intl/ itself)
  RewriteCond %{REQUEST_URI} ^(.+)/$
  RewriteCond %{REQUEST_URI} !^/?$
  RewriteCond %{DOCUMENT_ROOT}%1.html -f
  RewriteRule ^(.+)/$ $1.html [L]
  
  # PRIORITY 2: If the requested file exists, serve it
  RewriteCond %{REQUEST_FILENAME} -f
  RewriteRule ^ - [L]
  
  # PRIORITY 3: For all other routes that don't exist as files, serve index.html
  # This allows Next.js client-side routing to handle the route
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^(.*)$ index.html [L]
</IfModule>

# Optional: Set proper MIME types
<IfModule mod_mime.c>
  AddType text/html .html
  AddType application/javascript .js
  AddType text/css .css
  AddType application/json .json
</IfModule>

# Enable compression
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Security headers
<IfModule mod_headers.c>
  # Prevent MIME type sniffing
  Header set X-Content-Type-Options "nosniff"
  
  # Enable XSS protection
  Header set X-XSS-Protection "1; mode=block"
  
  # Clickjacking protection
  Header set X-Frame-Options "SAMEORIGIN"
  
  # Add CORS headers for API requests (adjust origins as needed)
  <FilesMatch "\.(json)$">
    Header set Access-Control-Allow-Origin "*"
    Header set Access-Control-Allow-Methods "GET, POST, OPTIONS"
    Header set Access-Control-Allow-Headers "Content-Type"
  </FilesMatch>
</IfModule>

# Cache control for static assets
<IfModule mod_expires.c>
  ExpiresActive On
  
  # Images
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType image/x-icon "access plus 1 year"
  
  # CSS and JavaScript
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
  
  # Fonts
  ExpiresByType font/ttf "access plus 1 year"
  ExpiresByType font/otf "access plus 1 year"
  ExpiresByType font/woff "access plus 1 year"
  ExpiresByType font/woff2 "access plus 1 year"
  
  # HTML (should not be cached too long for SPAs)
  ExpiresByType text/html "access plus 0 seconds"
</IfModule>